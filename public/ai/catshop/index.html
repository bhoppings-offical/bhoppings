<html><head><base href="/">
<style>
  body {
    margin: 0;
    padding: 20px;
    background: #f4e4bc;
    font-family: Arial, sans-serif;
    transition: background-color 0.5s;
    position: relative;
    min-height: 100vh;
  }

  .firey-container {
    position: fixed;
    bottom: 0;
    left: 0;
    width: 100%;
    height: 100vh;
    z-index: -1;
    display: none;
    justify-content: center;
  }

  body.evil-mode .firey-container {
    display: flex;
  }

  .firey-container img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .shop {
    width: 100%;
    max-width: 800px;
    margin: 0 auto;
    background: #8b4513;
    padding: 20px;
    border-radius: 10px;
    box-shadow: 0 0 20px rgba(0,0,0,0.3);
  }

  .shop.spinning {
    animation: spin 2s linear infinite;
  }

  @keyframes spin {
    from { transform: rotate(0deg); }
    to { transform: rotate(360deg); }
  }

  .shopkeeper {
    width: 200px;
    height: 200px;
    margin: 20px auto;
    display: block;
    object-fit: contain;
  }

  .shelves {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 20px;
    margin-top: 20px;
  }

  .shelf {
    min-height: 180px;
    background: #654321;
    border: 4px solid #3a2512;
    border-radius: 5px;
    position: relative;
    padding: 20px;
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    grid-template-rows: repeat(3, 1fr);
    gap: 15px;
    justify-items: center;
    align-items: center;
  }

  .item {
    width: 50px;
    height: 50px;
    background: #ddd;
    border-radius: 5px;
    cursor: pointer;
    transition: transform 0.3s;
    display: flex;
    justify-content: center;
    align-items: center;
  }

  .item:hover {
    transform: scale(1.1);
  }

  .item-wenda {
    background: transparent;
    transition: opacity 0.3s;
  }

  .item-wenda.cooldown {
    opacity: 0;
    pointer-events: none;
  }

  .item-2017x {
    background: transparent;
  }

  .item-2017x img {
    width: 100%;
    height: 100%;
    object-fit: contain;
  }

  .item-wega {
    background: #8a2be2;
  }

  .item-nugget, .item-max {
    background: transparent;
  }

  .nugget-img, .max-img {
    width: 100%;
    height: 100%;
    object-fit: contain;
  }

  .music-note {
    font-size: 24px;
  }

  .paint-brush {
    font-size: 24px;
  }

  .theme-icon {
    font-size: 24px;
    color: white;
  }

  .gear-icon {
    width: 30px;
    height: 30px;
  }

  .dialog {
    position: relative;
    min-height: 80px;
    display: flex;
    flex-direction: column;
    gap: 10px;
    align-items: center;
  }

  .message {
    background: white;
    padding: 10px;
    border-radius: 8px;
    animation: fadeIn 0.3s;
    width: 90%;
    text-align: center;
    font-family: 'DTM-Sans', Arial, sans-serif;
  }

  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(-10px); }
    to { opacity: 1; transform: translateY(0); }
  }

  @keyframes falling {
    0% { transform: translateY(0) rotate(0deg); }
    100% { transform: translateY(200%) rotate(360deg) skew(20deg); }
  }

  .falling {
    animation: falling 1s ease-in forwards;
  }

  .item-paint {
    background: linear-gradient(45deg, red, blue, green);
  }

  .item-music {
    background: #ddd;
  }
  
  .item-theme {
    background: #444;
  }

  .jumpscare {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: black;
    z-index: 1000;
    justify-content: center;
    align-items: center;
  }

  .jumpscare img {
    width: 80%;
    max-width: 500px;
  }

  .jumpscare.active {
    display: flex;
  }

  .help-button {
    position: absolute;
    top: -30px;
    left: 50%;
    transform: translateX(-50%);
    width: 80px;
    height: 30px;
    cursor: pointer;
    display: none;
  }

  body.evil-mode {
    background: #000000;
  }

  .item-wenda, .item-sonic {
    background: transparent;
  }

  .wenda-img, .sonic-img {
    width: 100%;
    height: 100%;
    object-fit: contain;
  }
  @font-face {
    font-family: 'DTM-Sans';
    src: url('DTM-Sans.otf') format('opentype');
  }

  .boss-battle {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.9);
    z-index: 1000;
  }

  .boss-battle.active {
    display: block;
  }

  .player-soul {
    position: absolute;
    width: 20px;
    height: 20px;
    transition: transform 0.1s linear;
  }

  .player-soul img {
    width: 100%;
    height: 100%;
  }

  .boss {
    position: absolute;
    width: 100px;
    height: 100px;
    transition: transform 0.5s ease-out;
  }

  .boss img {
    width: 100%;
    height: 100%;
  }

  .health-bars {
    position: fixed;
    top: 20px;
    left: 20px;
    z-index: 1001;
    display: none;
  }

  .health-bars.active {
    display: block;
  }

  .health-bar {
    width: 200px;
    height: 20px;
    background: #333;
    margin: 10px 0;
  }

  .health-fill {
    height: 100%;
    background: red;
    transition: width 0.3s;
  }

  .boss-health {
    width: 100%;
    max-width: 200px;
  }

  .bullet {
    position: absolute;
    width: 15px;
    height: 15px;
    z-index: 1001;
  }

  .bullet img {
    width: 100%;
    height: 100%;
  }

  .gun {
    position: absolute;
    width: 30px;
    height: 30px;
    z-index: 1001;
    transform-origin: center;
  }

  .gun img {
    width: 100%;
    height: 100%;
  }

  .fire-attack {
    position: absolute;
    width: 30px;
    height: 30px;
    z-index: 1001;
  }

  .fire-attack img {
    width: 100%;
    height: 100%;
  }
  
  /* Add new mobile controls styles */
  .mobile-controls,
  .mobile-button {
    display: none !important;
  }

  .joystick-container {
    position: fixed;
    bottom: 20px;
    left: 20px;
    width: 150px;
    height: 150px;
    background: rgba(255,255,255,0.3);
    border-radius: 50%;
    display: none;
    touch-action: none;
    z-index: 1002;
  }

  .joystick-knob {
    position: absolute;
    width: 50px;
    height: 50px;
    background: rgba(255,255,255,0.8);
    border-radius: 50%;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    pointer-events: none;
  }

  .red-bullet {
    position: absolute;
    width: 15px;
    height: 15px;
    z-index: 1001;
    background: red;
    border-radius: 50%;
  }

  /* Add trail effect styles */
  .boss-trail {
    position: absolute;
    width: 100px;
    height: 100px;
    opacity: 0.5;
    transition: opacity 0.3s;
    z-index: 1000;
  }

  .boss-trail img {
    width: 100%;
    height: 100%;
  }

  .boss.dashing {
    opacity: 0.7;
}

.mario-item {
  background: transparent !important;
  transition: transform 0.3s;
}

.mario-img {
  width: 100%;
  height: 100%;
  object-fit: contain;
}

.mario-jump {
  animation: marioJump 0.5s;
}

.mario-blj {
  animation: marioBLJ 0.5s linear infinite;
}

@keyframes marioJump {
  0%, 100% { transform: translateY(0); }
  50% { transform: translateY(-20px); }
}

@keyframes marioBLJ {
  from { transform: translateX(-100%); }
  to { transform: translateX(100vw); }
}

.bell-warning {
  position: absolute;
  border: 2px solid red;
  border-radius: 50%;
  pointer-events: none;
  opacity: 0.5;
  z-index: 1001;
}

.bell {
  position: absolute; 
  width: 40px;
  height: 40px;
  z-index: 1001;
}

.bell img {
  width: 100%;
  height: 100%;
}

.max-boss {
  position: absolute;
  width: 100px;
  height: 100px;
  z-index: 1001;
}

.max-boss img {
  width: 100%;
  height: 100%;
}

.help-attack {
  position: absolute;
  width: 80px;
  height: 30px;
  z-index: 1001;
}

.help-attack img {
  width: 100%;
  height: 100%;
}

.boss.teleporting {
  opacity: 0.3;
  transition: opacity 0.2s;
}

.homing-bullet {
  position: absolute;
  width: 15px;
  height: 15px;
  z-index: 1001;
}

.homing-bullet img {
  width: 100%;
  height: 100%;
  transform: rotate(180deg);
}

  .youtube-attack {
    position: absolute;
    width: 40px;
    height: 40px;
    z-index: 1001;
  }

  .youtube-attack img {
    width: 100%;
    height: 100%;
  }
</style>
</head>
<body>
  <div class="firey-container">
    <img src="/Firey_Burning.webp" alt="Firey background">
  </div>

  <div class="shop">
    <img src="floppa_png-removebg-preview.png" class="shopkeeper" alt="Caracal shopkeeper">
    
    <div class="dialog">
    </div>

    <div class="shelves">
      <div class="shelf">
        <div class="item item-paint" data-type="color"><span class="paint-brush">&#x1f58c;&#xfe0f;</span></div>
        <div class="item item-music" data-type="music"><span class="music-note">&#x1f3b5;</span></div>
        <div class="item item-theme" data-type="theme"><span class="theme-icon">&#x1f313;</span></div>
        <div class="item item-wega" data-type="wega">
          <img src="Additional Settings.png" class="gear-icon" alt="Settings">
        </div>
        <div class="item item-nugget" data-type="nugget" style="position: relative;">
          <img src="/Here2.png" class="help-button" alt="Help Button">
          <img src="/nuget.png" class="nugget-img" alt="Nugget">
        </div>
        <div class="item item-max" data-type="max">
          <img src="Czqr93wr_400x400.jpg" class="max-img" alt="Max">
        </div>
      </div>
      <div class="shelf">
        <div class="item item-wenda" data-type="wenda">
          <img src="Wenda.webp" class="wenda-img" alt="Wenda">
        </div>
        <div class="item item-sonic" data-type="sonic">
          <img src="de04vru-e038404c-68d8-429a-8cfc-09f16ccaa68b.png" class="sonic-img" alt="Sonic">
        </div>
        <div class="item"></div>
        <div class="item item-2017x" data-type="2017x" style="display: none;">
          <img src="16E49AE2-8B4F-4262-A0EC-0759199B5247.jpeg" alt="2017x">
        </div>
        <div class="item mario-item" data-type="mario">
          <img src="The entity.jpeg" class="mario-img" alt="Mario">
        </div>
        <div class="item"></div>
      </div>
      <div class="shelf">
        <div class="item"></div>
        <div class="item"></div>
        <div class="item"></div>
        <div class="item"></div>
        <div class="item"></div>
        <div class="item"></div>
      </div>
      <div class="shelf">
        <div class="item"></div>
        <div class="item"></div>
        <div class="item"></div>
        <div class="item"></div>
        <div class="item"></div>
        <div class="item"></div>
      </div>
    </div>
  </div>

  <div class="jumpscare">
    <img src="/wega-sticker (1).gif" alt="Wega jumpscare">
  </div>

  <div class="boss-battle">
    <div class="health-bars">
      <div class="health-bar">
        <div class="health-fill player-health" style="width: 100%"></div>
      </div>
      <div class="health-bar">
        <div class="health-fill boss-health" style="width: 100%"></div>
      </div>
    </div>
    <div class="player-soul">
      <img src="undertale-red-soul-logo-8D3C517EF0-seeklogo.com.png" alt="Player soul">
    </div>
    <div class="gun">
      <img src="Item_Glock-sharedassets4.assets-616.webp" alt="Gun">
    </div>
    <div class="boss">
      <img src="16E49AE2-8B4F-4262-A0EC-0759199B5247.jpeg" alt="2017x">
    </div>
  </div>

  <div class="joystick-container">
    <div class="joystick-knob"></div>
  </div>

  <script>const bgMusic = new Audio('Undertale OST_ 054 - Hotel [ ezmp3.cc ].mp3');
const jumpscareSound = new Audio('wega-jumpscare.mp3');
const helpSound = new Audio('WHATHELPME.wav');
const nuggetSong = new Audio('Chicken Nugget Singing Gedagedigedagedago [TubeRipper.com].mp3');
const twiddlefingerMusic = new Audio('TWIDDLEFINGER INSTRUMENTAL.mp3');
const wendaSound = new Audio('wenda loop.wav');
const yippeeSound = new Audio('yippee-tbh.mp3');
const meowSound = new Audio('raise-a-floppa-meow.mp3');
const getOutSound = new Audio('GET OUT.mp3');
const bossBattleMusic = new Audio('Subterfuge Garn47 Instrumental 4-[AudioTrimmer.com].mp3');
const marioJumpSound = new Audio('maro-jump-sound-effect_1 (1).mp3');
const marioWahooSound = new Audio('wahoo.wav');
const marioSliderMusic = new Audio('05. Slider.mp3');
const bellSound = new Audio('pizza tower lap 2 bells 4.mp3');
bgMusic.loop = true;
twiddlefingerMusic.loop = true;
bossBattleMusic.loop = true;
marioSliderMusic.loop = true;
bgMusic.volume = 0.5;
twiddlefingerMusic.volume = 0.5;
nuggetSong.volume = 0.7;
let isMusicPlaying = true;
let isMaxEvil = false;
const colors = ['#f4e4bc', '#c2e6ff', '#ffc2e6', '#e6ffc2'];
let colorIndex = 0;
const items = document.querySelectorAll('.item');
const jumpscareElement = document.querySelector('.jumpscare');
const nuggetImg = document.querySelector('.nugget-img');
const maxImg = document.querySelector('.max-img');
const helpButton = document.querySelector('.help-button');
let wendaClickCount = 0;
let wendaDisabled = false;
let activeMessages = [];
const MAX_MESSAGES = 3;
let wendaTimeout = null;
let bossBattle = {
  active: false,
  playerHealth: 100,
  bossHealth: 100,
  playerPos: {
    x: 0,
    y: 0
  },
  bossPos: {
    x: 0,
    y: 0
  },
  bullets: [],
  fireAttacks: [],
  lastFireTime: 0,
  fireDamageInterval: null,
  bellRadius: 20,
  bells: [],
  bellWarnings: [],
  hitBells: new Set()
};
let bossBattleChance = {
  sonic: 0.9,
  other: 0.999
};
const PLAYER_SPEED = 5;
const BULLET_SPEED = 10;
const BOSS_SPEED = 4;
const FIRE_RANGE = 150;
const BULLET_FIRE_INTERVAL = 500;
const CIRCLE_BULLET_COUNT = 12;
const CIRCLE_BULLET_SPEED = 5;
const CIRCLE_BULLET_INTERVAL = 2000;
let lastCircleAttackTime = 0;
let lastBulletTime = 0;
let userInteracted = false;
let lastDashTime = 0;
const DASH_COOLDOWN = 3000;
const DASH_DURATION = 1000;
let isDashing = false;
let trails = [];
let marioClickCount = 0;
let marioBLJCount = 0;
let isBLJing = false;
let maxClickCount = 0;
let lastMaxClick = 0;
const MAX_CLICK_INTERVAL = 1000;
const MAX_CLICKS_NEEDED = 5;
let helpAttacks = [];
let lastTeleportTime = 0;
const TELEPORT_COOLDOWN = 2000;
let autoFireInterval = null;
const HOMING_BULLET_SPEED = 8;
const HOMING_BULLET_INTERVAL = 500;
let homingBullets = [];
let lastHomingBulletTime = 0;
let youtubeAttacks = [];
let lastYoutubeAttackTime = 0;
const YOUTUBE_ATTACK_INTERVAL = 5000;
const YOUTUBE_SPEED = 10;
setInterval(() => {
  if (Math.random() < 0.1 && userInteracted) {
    helpSound.play().catch(err => console.log("Error playing help sound:", err));
    nuggetImg.src = 'NOOGETE.png';
    updateDialog('WHAT!? HELP ME!');
    setTimeout(() => {
      nuggetImg.src = 'nuget.png';
    }, 3000);
  }
}, 30000);
helpButton.addEventListener('click', e => {
  e.stopPropagation();
  if (isMaxEvil) {
    isMaxEvil = false;
    maxImg.src = 'Czqr93wr_400x400.jpg';
    twiddlefingerMusic.pause();
    helpButton.style.display = 'none';
    document.body.classList.remove('evil-mode');
    if (isMusicPlaying) {
      bgMusic.play();
    }
    nuggetImg.src = 'nuget.png';
    maxClickCount = 0;
    updateDialog('Phew, he\'s back to normal!');
  }
});
items.forEach(item => {
  item.addEventListener('click', () => {
    if (item.dataset.type === 'max') {
      const now = Date.now();
      if (now - lastMaxClick < MAX_CLICK_INTERVAL) {
        maxClickCount++;
        if (maxClickCount >= MAX_CLICKS_NEEDED) {
          maxClickCount = 0;
          startBossBattle(true);
          return;
        }
      } else {
        maxClickCount = 1;
      }
      lastMaxClick = now;
      if (!isMaxEvil) {
        isMaxEvil = true;
        maxImg.src = 'MAXEDD.png';
        bgMusic.pause();
        helpButton.style.display = 'block';
        document.body.classList.add('evil-mode');
        if (isMusicPlaying) {
          twiddlefingerMusic.play();
        }
        nuggetImg.src = 'NOOGETE.png';
        helpSound.play().catch(err => console.log("Error playing help sound:", err));
        updateDialog('WHAT!? HELP ME!');
      }
    } else if (item.dataset.type === 'sonic') {
      if (Math.random() > bossBattleChance.sonic) {
        startBossBattle();
        return;
      }
    } else if (Math.random() > bossBattleChance.other) {
      startBossBattle();
      return;
    }
    const type = item.dataset.type;
    if (!type && item.parentElement === document.querySelectorAll('.shelf')[1] && Array.from(item.parentElement.children).indexOf(item) === 2) {
      alert("it's hot in here...");
      return;
    }
    if (!type) {
      alert("This item isn't done yet, feel free to give a suggestion though!");
      return;
    }
    if (type === 'color') {
      document.body.style.background = colors[colorIndex];
      colorIndex = (colorIndex + 1) % colors.length;
      updateDialog('Meow! Changed the color for you!');
    } else if (type === 'music') {
      if (isMusicPlaying) {
        bgMusic.pause();
        twiddlefingerMusic.pause();
        updateDialog('Music paused! Meow~');
      } else {
        if (isMaxEvil) {
          twiddlefingerMusic.play();
        } else {
          bgMusic.play();
        }
        updateDialog('Music resumed! Meow~');
      }
      isMusicPlaying = !isMusicPlaying;
    } else if (type === 'theme') {
      document.body.style.filter = document.body.style.filter === 'invert(1)' ? 'none' : 'invert(1)';
      updateDialog('Changed the theme! How do you like it? Meow!');
    } else if (type === 'wega') {
      updateDialog('DON\'T TOUCH THAT ONE!');
      bgMusic.pause();
      twiddlefingerMusic.pause();
      jumpscareSound.play().catch(err => console.log("Error playing jumpscare sound:", err));
      jumpscareElement.classList.add('active');
      nuggetImg.src = 'NOOGETE.png';
      setTimeout(() => {
        jumpscareElement.classList.remove('active');
        jumpscareSound.pause();
        jumpscareSound.currentTime = 0;
        nuggetImg.src = 'nuget.png';
        if (isMusicPlaying) {
          if (isMaxEvil) {
            twiddlefingerMusic.play();
          } else {
            bgMusic.play();
          }
        }
      }, 3000);
    } else if (type === 'nugget') {
      const currentMusic = isMaxEvil ? twiddlefingerMusic : bgMusic;
      if (currentMusic.volume > 0) {
        const originalVolume = currentMusic.volume;
        currentMusic.volume = 0.1;
        nuggetSong.play().catch(err => console.log("Error playing nugget song:", err));
        updateDialog('🎵 Geda gedi geda geda go! 🎵', 'nugget');
        nuggetSong.onended = () => {
          currentMusic.volume = originalVolume;
        };
      } else {
        nuggetSong.play().catch(err => console.log("Error playing nugget song:", err));
        updateDialog('🎵 Geda gedi geda geda go! 🎵', 'nugget');
      }
    } else if (type === 'wenda' && !wendaDisabled) {
      wendaClickCount++;
      wendaSound.play().catch(err => console.log("Error playing wenda sound:", err));
      updateDialog('Hey!', 'wenda');
      if (wendaClickCount >= 5) {
        wendaDisabled = true;
        getOutSound.play().catch(err => console.log("Error playing get out sound:", err));
        updateDialog('GET OUT!', 'wenda');
        const wendaImg = document.querySelector('.wenda-img');
        const wendaItem = document.querySelector('.item-wenda');
        wendaImg.classList.add('falling');
        setTimeout(() => {
          wendaImg.classList.remove('falling');
          wendaClickCount = 0;
          wendaItem.classList.add('cooldown');
          wendaTimeout = setTimeout(() => {
            wendaDisabled = false;
            wendaItem.classList.remove('cooldown');
            wendaTimeout = null;
          }, 10000);
        }, 1000);
      }
    } else if (type === 'sonic') {
      const sonicImg = document.querySelector('.sonic-img');
      sonicImg.src = '6b8a5e0c-88dc-4687-be81-e251e3e7f0a0.gif';
      yippeeSound.play().catch(err => console.log("Error playing yippee sound:", err));
      updateDialog('Yippee!', 'sonic');
      setTimeout(() => {
        sonicImg.src = 'de04vru-e038404c-68d8-429a-8cfc-09f16ccaa68b.png';
      }, 2000);
    } else if (type === '2017x') {
      const shop = document.querySelector('.shop');
      shop.classList.toggle('spinning');
    } else if (type === 'mario') {
      if (isBLJing) return;
      marioClickCount++;
      const marioImg = document.querySelector('.mario-img');
      if (marioClickCount < 15) {
        marioJumpSound.currentTime = 0;
        marioJumpSound.play();
        marioImg.src = "MalleoReuploadPopgamer06 Jump.png";
        marioImg.classList.add('mario-jump');
        setTimeout(() => {
          marioImg.classList.remove('mario-jump');
          marioImg.src = "The entity.jpeg";
        }, 500);
      } else if (!isBLJing) {
        isBLJing = true;
        marioSliderMusic.play();
        marioBLJCount = 0;
        function doBLJ() {
          if (marioBLJCount >= 5 || !isBLJing) {
            marioImg.classList.remove('mario-blj');
            marioImg.src = "The entity.jpeg";
            marioSliderMusic.pause();
            marioSliderMusic.currentTime = 0;
            marioClickCount = 0;
            isBLJing = false;
            return;
          }
          marioWahooSound.currentTime = 0;
          marioWahooSound.play();
          marioImg.src = "MalleoReuploadPopgamer06 Jump.png";
          marioImg.classList.add('mario-blj');
          setTimeout(() => {
            marioImg.classList.remove('mario-blj');
            setTimeout(() => {
              marioBLJCount++;
              doBLJ();
            }, 100);
          }, 500);
        }
        doBLJ();
      }
    }
  });
});
function updateDialog(text, character = 'shopkeeper') {
  const dialog = document.querySelector('.dialog');
  const messageEl = document.createElement('div');
  messageEl.className = 'message';
  messageEl.textContent = text;
  messageEl.style.alignSelf = character === 'wenda' ? 'flex-start' : character === 'sonic' ? 'flex-end' : 'center';
  activeMessages.push({
    element: messageEl,
    character: character,
    timestamp: Date.now()
  });
  while (activeMessages.length > MAX_MESSAGES) {
    const oldest = activeMessages.shift();
    oldest.element.remove();
  }
  dialog.appendChild(messageEl);
  if (character === 'shopkeeper' && userInteracted) {
    meowSound.currentTime = 0;
    meowSound.play().catch(err => console.log("Error playing meow sound:", err));
  }
  if (text !== 'Welcome to my shop! Meow~ I have some magical items for you!') {
    setTimeout(() => {
      messageEl.remove();
      activeMessages = activeMessages.filter(m => m.element !== messageEl);
      if (activeMessages.length === 0) {
        updateDialog('Welcome to my shop! Meow~ I have some magical items for you!');
      }
    }, 3000);
  }
}
updateDialog('Welcome to my shop! Meow~ I have some magical items for you!');
document.addEventListener('click', function initAudio() {
  userInteracted = true;
  bgMusic.play().catch(err => console.log("Error playing background music:", err));
  document.removeEventListener('click', initAudio);
}, {
  once: true
});
function startBossBattle(isMaxBoss = false) {
  bossBattle.active = true;
  bossBattle.playerHealth = 100;
  bossBattle.bossHealth = 100;
  document.querySelector('.boss-battle').classList.add('active');
  document.querySelector('.health-bars').classList.add('active');
  if ('ontouchstart' in window) {
    document.querySelector('.joystick-container').style.display = 'block';
  }
  bgMusic.pause();
  twiddlefingerMusic.pause();
  bossBattleMusic.pause();
  if (isMaxBoss) {
    twiddlefingerMusic.currentTime = 0;
    twiddlefingerMusic.play();
  } else {
    bossBattleMusic.currentTime = 0;
    bossBattleMusic.play();
  }
  const battleArea = document.querySelector('.boss-battle');
  bossBattle.playerPos = {
    x: battleArea.clientWidth / 2,
    y: battleArea.clientHeight - 100
  };
  bossBattle.bossPos = {
    x: battleArea.clientWidth / 2,
    y: 100
  };
  const bossImg = document.querySelector('.boss img');
  bossImg.src = isMaxBoss ? 'MAXEDD.png' : '16E49AE2-8B4F-4262-A0EC-0759199B5247.jpeg';
  bossBattle.isMaxBoss = isMaxBoss;
  bossBattle.bells = [];
  bossBattle.bellWarnings = [];
  bossBattle.lastBellTime = Date.now();
  bossBattle.bellSpawnInterval = isMaxBoss ? 2000 : 3000;
  bossBattle.bellRadius = 100;
  bossBattle.hitBells = new Set();
  helpAttacks = [];
  if (isMaxBoss) {
    youtubeAttacks = [];
    lastYoutubeAttackTime = Date.now();
  }
  updatePositions();
  setupBossBattleControls();
}
function updatePositions() {
  const soul = document.querySelector('.player-soul');
  const boss = document.querySelector('.boss');
  const gun = document.querySelector('.gun');
  soul.style.transform = `translate(${bossBattle.playerPos.x}px, ${bossBattle.playerPos.y}px)`;
  boss.style.transform = `translate(${bossBattle.bossPos.x}px, ${bossBattle.bossPos.y}px)`;
  gun.style.transform = `translate(${bossBattle.playerPos.x + 30}px, ${bossBattle.playerPos.y}px)`;
}
function setupBossBattleControls() {
  const keyState = {};
  window.addEventListener('keydown', e => {
    keyState[e.key] = true;
  });
  window.addEventListener('keyup', e => {
    keyState[e.key] = false;
  });
  if (!('ontouchstart' in window)) {
    window.addEventListener('mousemove', e => {
      if (!bossBattle.active) return;
      const battleArea = document.querySelector('.boss-battle');
      const rect = battleArea.getBoundingClientRect();
      bossBattle.playerPos.x = e.clientX - rect.left;
      bossBattle.playerPos.y = e.clientY - rect.top;
    });
  }
  let joystickActive = false;
  let joystickPos = {
    x: 0,
    y: 0
  };
  let lastBulletTime = Date.now();
  let lastCircleAttackTime = Date.now();
  let isDashing = false;
  let lastDashTime = Date.now();
  const DASH_COOLDOWN = 5000;
  const DASH_DURATION = 2000;
  const joystickContainer = document.querySelector('.joystick-container');
  const joystickKnob = document.querySelector('.joystick-knob');
  if ('ontouchstart' in window) {
    joystickContainer.style.display = 'block';
  }
  joystickContainer.addEventListener('touchstart', e => {
    joystickActive = true;
    updateJoystickPosition(e.touches[0]);
  });
  joystickContainer.addEventListener('touchmove', e => {
    if (joystickActive) {
      updateJoystickPosition(e.touches[0]);
    }
  });
  joystickContainer.addEventListener('touchend', () => {
    joystickActive = false;
    joystickKnob.style.transform = 'translate(-50%, -50%)';
    joystickPos = {
      x: 0,
      y: 0
    };
  });
  function updateJoystickPosition(touch) {
    const rect = joystickContainer.getBoundingClientRect();
    const centerX = rect.left + rect.width / 2;
    const centerY = rect.top + rect.height / 2;
    let dx = touch.clientX - centerX;
    let dy = touch.clientY - centerY;
    const distance = Math.sqrt(dx * dx + dy * dy);
    const maxDistance = rect.width / 2;
    if (distance > maxDistance) {
      dx = dx / distance * maxDistance;
      dy = dy / distance * maxDistance;
    }
    joystickKnob.style.transform = `translate(${dx}px, ${dy}px)`;
    joystickPos = {
      x: dx / maxDistance,
      y: dy / maxDistance
    };
  }
  let autoFireInterval;
  function startAutoFire() {
    if (!autoFireInterval) {
      autoFireInterval = setInterval(() => {
        if (bossBattle.active) {
          fireBullet();
        }
      }, BULLET_FIRE_INTERVAL);
    }
  }
  let lastYoutubeAttackTime = Date.now();
  function gameLoop() {
    if (!bossBattle.active) {
      if (autoFireInterval) {
        clearInterval(autoFireInterval);
        autoFireInterval = null;
      }
      return;
    }
    if (joystickActive) {
      const battleArea = document.querySelector('.boss-battle');
      bossBattle.playerPos.x += joystickPos.x * PLAYER_SPEED;
      bossBattle.playerPos.y += joystickPos.y * PLAYER_SPEED;
      bossBattle.playerPos.x = Math.max(0, Math.min(battleArea.clientWidth - 20, bossBattle.playerPos.x));
      bossBattle.playerPos.y = Math.max(0, Math.min(battleArea.clientHeight - 20, bossBattle.playerPos.y));
    }
    startAutoFire();
    if (!bossBattle.isMaxBoss) {
      const dx = bossBattle.playerPos.x - bossBattle.bossPos.x;
      const dy = bossBattle.playerPos.y - bossBattle.bossPos.y;
      const dist = Math.sqrt(dx * dx + dy * dy);
      if (!isDashing && Date.now() - lastDashTime > DASH_COOLDOWN && Math.random() < 0.02) {
        isDashing = true;
        lastDashTime = Date.now();
        document.querySelector('.boss').classList.add('dashing');
        const trail = document.createElement('div');
        trail.className = 'boss-trail';
        trail.innerHTML = '<img src="16E49AE2-8B4F-4262-A0EC-0759199B5247.jpeg" alt="2017x trail">';
        trail.style.transform = `translate(${bossBattle.bossPos.x}px, ${bossBattle.bossPos.y}px)`;
        document.querySelector('.boss-battle').appendChild(trail);
        trails.push(trail);
        setTimeout(() => {
          trail.style.opacity = '0';
          setTimeout(() => {
            trail.remove();
            trails = trails.filter(t => t !== trail);
          }, 300);
        }, DASH_DURATION);
        setTimeout(() => {
          isDashing = false;
          document.querySelector('.boss').classList.remove('dashing');
        }, DASH_DURATION);
      }
      const speed = isDashing ? BOSS_SPEED * 5 : BOSS_SPEED;
      if (!isDashing) {
        bossBattle.bossPos.x += dx / dist * BOSS_SPEED;
        bossBattle.bossPos.y += dy / dist * BOSS_SPEED;
      }
      if (dist < FIRE_RANGE) {
        if (Date.now() - bossBattle.lastFireTime > 1000) {
          createFireAttack();
          bossBattle.lastFireTime = Date.now();
        }
        if (Math.random() < 0.02) {
          fireCircularBullets();
        }
      } else if (Date.now() - lastCircleAttackTime > CIRCLE_BULLET_INTERVAL) {
        fireCircularBullets();
        lastCircleAttackTime = Date.now();
      }
    }
    if (bossBattle.isMaxBoss) {
      if (Date.now() - lastTeleportTime > TELEPORT_COOLDOWN && Math.random() < 0.1) {
        const battleArea = document.querySelector('.boss-battle');
        document.querySelector('.boss').classList.add('teleporting');
        setTimeout(() => {
          bossBattle.bossPos.x = Math.random() * (battleArea.clientWidth - 100);
          bossBattle.bossPos.y = Math.random() * (battleArea.clientHeight - 100);
          document.querySelector('.boss').classList.remove('teleporting');
          throwHelpButton();
        }, 200);
        lastTeleportTime = Date.now();
      }
      updateHelpAttacks();
      if (Date.now() - lastYoutubeAttackTime > YOUTUBE_ATTACK_INTERVAL && Math.random() < 0.1) {
        createYoutubeAttack();
        lastYoutubeAttackTime = Date.now();
      }
      updateYoutubeAttacks();
    }
    updatePositions();
    updateBullets();
    updateFireAttacks();
    checkCollisions();
    if (bossBattle.isMaxBoss && Date.now() - bossBattle.lastBellTime > bossBattle.bellSpawnInterval) {
      spawnBellWarning();
      bossBattle.lastBellTime = Date.now();
    }
    if (bossBattle.isMaxBoss) {
      updateBells();
    }
    requestAnimationFrame(gameLoop);
  }
  startAutoFire();
  gameLoop();
}
function fireBullet() {
  const now = Date.now();
  if (now - lastHomingBulletTime > HOMING_BULLET_INTERVAL) {
    const bullet = document.createElement('div');
    bullet.className = 'homing-bullet';
    bullet.innerHTML = '<img src="B1.png" alt="Homing Bullet">';
    const battleArea = document.querySelector('.boss-battle');
    battleArea.appendChild(bullet);
    homingBullets.push({
      element: bullet,
      x: bossBattle.playerPos.x,
      y: bossBattle.playerPos.y,
      vx: 0,
      vy: 0
    });
    lastHomingBulletTime = now;
  }
  const regularBullet = document.createElement('div');
  regularBullet.className = 'bullet';
  regularBullet.innerHTML = '<img src="B1.png" alt="Bullet">';
  const battleArea = document.querySelector('.boss-battle');
  battleArea.appendChild(regularBullet);
  const dx = bossBattle.bossPos.x - bossBattle.playerPos.x;
  const dy = bossBattle.bossPos.y - bossBattle.playerPos.y;
  const dist = Math.sqrt(dx * dx + dy * dy);
  const angle = Math.atan2(dy, dx) * 180 / Math.PI;
  const gun = document.querySelector('.gun');
  gun.style.transform = `translate(${bossBattle.playerPos.x}px, ${bossBattle.playerPos.y}px) rotate(${angle}deg)`;
  bossBattle.bullets.push({
    element: regularBullet,
    x: bossBattle.playerPos.x,
    y: bossBattle.playerPos.y,
    vx: dx / dist * BULLET_SPEED,
    vy: dy / dist * BULLET_SPEED
  });
}
function createFireAttack() {
  const fire = document.createElement('div');
  fire.className = 'fire-attack';
  fire.innerHTML = '<img src="Firey_Burning.webp" alt="Fire">';
  const battleArea = document.querySelector('.boss-battle');
  battleArea.appendChild(fire);
  bossBattle.fireAttacks.push({
    element: fire,
    x: bossBattle.bossPos.x,
    y: bossBattle.bossPos.y
  });
}
function updateBullets() {
  bossBattle.bullets.forEach((bullet, index) => {
    bullet.x += bullet.vx;
    bullet.y += bullet.vy;
    bullet.element.style.transform = `translate(${bullet.x}px, ${bullet.y}px)`;
    if (bullet.x < 0 || bullet.x > window.innerWidth || bullet.y < 0 || bullet.y > window.innerHeight) {
      bullet.element.remove();
      bossBattle.bullets.splice(index, 1);
    }
  });
  homingBullets.forEach((bullet, index) => {
    const dx = bossBattle.bossPos.x - bullet.x;
    const dy = bossBattle.bossPos.y - bullet.y;
    const dist = Math.sqrt(dx * dx + dy * dy);
    bullet.vx = dx / dist * HOMING_BULLET_SPEED;
    bullet.vy = dy / dist * HOMING_BULLET_SPEED;
    bullet.x += bullet.vx;
    bullet.y += bullet.vy;
    const angle = Math.atan2(dy, dx) * 180 / Math.PI;
    bullet.element.style.transform = `translate(${bullet.x}px, ${bullet.y}px) rotate(${angle}deg)`;
    const bulletToBossDist = Math.sqrt(Math.pow(bullet.x - bossBattle.bossPos.x, 2) + Math.pow(bullet.y - bossBattle.bossPos.y, 2));
    if (bulletToBossDist < 30) {
      bossBattle.bossHealth -= 2.5;
      document.querySelector('.boss-health').style.width = `${bossBattle.bossHealth}%`;
      bullet.element.remove();
      homingBullets.splice(index, 1);
      if (bossBattle.bossHealth <= 0) {
        endBossBattle(true);
      }
    }
    if (bullet.x < 0 || bullet.x > window.innerWidth || bullet.y < 0 || bullet.y > window.innerHeight) {
      bullet.element.remove();
      homingBullets.splice(index, 1);
    }
  });
}
function updateFireAttacks() {
  if (!bossBattle.isMaxBoss) {
    bossBattle.fireAttacks.forEach((fire, index) => {
      fire.element.style.transform = `translate(${fire.x}px, ${fire.y}px)`;
      setTimeout(() => {
        fire.element.remove();
        bossBattle.fireAttacks.splice(index, 1);
      }, 2000);
    });
  }
}
function checkCollisions() {
  if (!bossBattle.isMaxBoss) {
    bossBattle.bullets.forEach((bullet, bulletIndex) => {
      const dx = bullet.x - bossBattle.playerPos.x;
      const dy = bullet.y - bossBattle.playerPos.y;
      const dist = Math.sqrt(dx * dx + dy * dy);
      if (dist < 30) {
        bossBattle.playerHealth -= 2;
        document.querySelector('.player-health').style.width = `${bossBattle.playerHealth}%`;
        bullet.element.remove();
        bossBattle.bullets.splice(bulletIndex, 1);
        if (bossBattle.playerHealth <= 0) {
          endBossBattle(false);
        }
      }
    });
    bossBattle.fireAttacks.forEach(fire => {
      const dx = fire.x - bossBattle.playerPos.x;
      const dy = fire.y - bossBattle.playerPos.y;
      const dist = Math.sqrt(dx * dx + dy * dy);
      if (dist < 30) {
        bossBattle.playerHealth -= 2;
        document.querySelector('.player-health').style.width = `${bossBattle.playerHealth}%`;
        if (bossBattle.playerHealth <= 0) {
          endBossBattle(false);
        }
      }
    });
  }
  if (bossBattle.isMaxBoss) {
    helpAttacks.forEach((help, index) => {
      const dx = help.x - bossBattle.playerPos.x;
      const dy = help.y - bossBattle.playerPos.y;
      const dist = Math.sqrt(dx * dx + dy * dy);
      if (dist < 30) {
        bossBattle.playerHealth -= 10;
        document.querySelector('.player-health').style.width = `${bossBattle.playerHealth}%`;
        help.element.remove();
        helpAttacks.splice(index, 1);
        if (bossBattle.playerHealth <= 0) {
          endBossBattle(false);
        }
      }
    });
    youtubeAttacks.forEach((attack, index) => {
      const dx = attack.x - bossBattle.playerPos.x;
      const dy = attack.y - bossBattle.playerPos.y;
      const dist = Math.sqrt(dx * dx + dy * dy);
      if (dist < 30) {
        bossBattle.playerHealth -= 15;
        document.querySelector('.player-health').style.width = `${bossBattle.playerHealth}%`;
        attack.element.remove();
        youtubeAttacks.splice(index, 1);
        if (bossBattle.playerHealth <= 0) {
          endBossBattle(false);
        }
      }
    });
  }
}
function endBossBattle(playerWon) {
  if (autoFireInterval) {
    clearInterval(autoFireInterval);
    autoFireInterval = null;
  }
  bossBattleMusic.pause();
  twiddlefingerMusic.pause();
  if (isMusicPlaying) {
    if (isMaxEvil) {
      twiddlefingerMusic.play();
    } else {
      bgMusic.play();
    }
  }
  if (playerWon) {
    const item2017x = document.querySelector('.item-2017x');
    item2017x.style.display = 'block';
  }
  bossBattle.active = false;
  document.querySelector('.boss-battle').classList.remove('active');
  document.querySelector('.health-bars').classList.remove('active');
  document.querySelector('.joystick-container').style.display = 'none';
  bossBattle.bullets.forEach(bullet => bullet.element.remove());
  bossBattle.fireAttacks.forEach(fire => fire.element.remove());
  bossBattle.bells.forEach(bell => bell.element.remove());
  bossBattle.bellWarnings.forEach(warning => warning.element.remove());
  bossBattle.bells = [];
  bossBattle.bellWarnings = [];
  bossBattle.hitBells.clear();
  helpAttacks.forEach(help => help.element.remove());
  helpAttacks = [];
  homingBullets.forEach(bullet => bullet.element.remove());
  homingBullets = [];
  youtubeAttacks.forEach(attack => attack.element.remove());
  youtubeAttacks = [];
  updateDialog(playerWon ? 'You defeated 2017x!' : 'Game Over!');
}
function fireCircularBullets() {
  for (let i = 0; i < CIRCLE_BULLET_COUNT; i++) {
    const angle = i / CIRCLE_BULLET_COUNT * Math.PI * 2;
    const bullet = document.createElement('div');
    bullet.className = 'red-bullet';
    const battleArea = document.querySelector('.boss-battle');
    battleArea.appendChild(bullet);
    bossBattle.bullets.push({
      element: bullet,
      x: bossBattle.bossPos.x,
      y: bossBattle.bossPos.y,
      vx: Math.cos(angle) * CIRCLE_BULLET_SPEED,
      vy: Math.sin(angle) * CIRCLE_BULLET_SPEED,
      isRedBullet: true
    });
  }
}
function throwHelpButton() {
  const help = document.createElement('div');
  help.className = 'help-attack';
  help.innerHTML = '<img src="/Here2.png" alt="Help Button">';
  document.querySelector('.boss-battle').appendChild(help);
  const dx = bossBattle.playerPos.x - bossBattle.bossPos.x;
  const dy = bossBattle.playerPos.y - bossBattle.bossPos.y;
  const dist = Math.sqrt(dx * dx + dy * dy);
  helpAttacks.push({
    element: help,
    x: bossBattle.bossPos.x,
    y: bossBattle.bossPos.y,
    vx: dx / dist * 8,
    vy: dy / dist * 8
  });
}
function updateHelpAttacks() {
  helpAttacks.forEach((help, index) => {
    help.x += help.vx;
    help.y += help.vy;
    help.element.style.transform = `translate(${help.x}px, ${help.y}px)`;
    const dx = help.x - bossBattle.playerPos.x;
    const dy = help.y - bossBattle.playerPos.y;
    const dist = Math.sqrt(dx * dx + dy * dy);
    if (dist < 30) {
      bossBattle.playerHealth -= 10;
      document.querySelector('.player-health').style.width = `${bossBattle.playerHealth}%`;
      help.element.remove();
      helpAttacks.splice(index, 1);
      if (bossBattle.playerHealth <= 0) {
        endBossBattle(false);
      }
    }
    if (help.x < 0 || help.x > window.innerWidth || help.y < 0 || help.y > window.innerHeight) {
      help.element.remove();
      helpAttacks.splice(index, 1);
    }
  });
}
function spawnBellWarning() {
  const battleArea = document.querySelector('.boss-battle');
  const x = Math.random() * (battleArea.clientWidth - 40);
  const y = Math.random() * (battleArea.clientHeight - 40);
  const warning = document.createElement('div');
  warning.className = 'bell-warning';
  warning.style.width = `${bossBattle.bellRadius * 2}px`;
  warning.style.height = `${bossBattle.bellRadius * 2}px`;
  warning.style.transform = `translate(${x - bossBattle.bellRadius}px, ${y - bossBattle.bellRadius}px)`;
  battleArea.appendChild(warning);
  bossBattle.bellWarnings.push({
    element: warning,
    x: x,
    y: y
  });
  setTimeout(() => {
    warning.remove();
    spawnBell(x, y);
  }, 1000);
}
function spawnBell(x, y) {
  bellSound.currentTime = 0;
  bellSound.play();
  const bell = document.createElement('div');
  bell.className = 'bell';
  bell.innerHTML = '<img src="AHHHHHHHPPMANISDEFEATED.png" alt="Bell">';
  bell.style.transform = `translate(${x}px, ${y}px)`;
  document.querySelector('.boss-battle').appendChild(bell);
  bossBattle.bells.push({
    element: bell,
    x: x,
    y: y,
    createdTime: Date.now()
  });
}
function updateBells() {
  bossBattle.bells.forEach((bell, index) => {
    if (Date.now() - bell.createdTime > 5000) {
      bell.element.remove();
      bossBattle.bells.splice(index, 1);
      return;
    }
    const dx = bossBattle.playerPos.x - bell.x;
    const dy = bossBattle.playerPos.y - bell.y;
    const dist = Math.sqrt(dx * dx + dy * dy);
    if (dist < bossBattle.bellRadius && !bossBattle.hitBells.has(bell)) {
      bossBattle.playerHealth -= 20;
      document.querySelector('.player-health').style.width = `${bossBattle.playerHealth}%`;
      bossBattle.hitBells.add(bell);
      if (bossBattle.playerHealth <= 0) {
        endBossBattle(false);
      }
    }
  });
}
function createYoutubeAttack() {
  const battleArea = document.querySelector('.boss-battle');
  const patterns = [{
    x: -40,
    y: battleArea.clientHeight / 4
  }, {
    x: battleArea.clientWidth,
    y: battleArea.clientHeight / 2
  }, {
    x: -40,
    y: battleArea.clientHeight / 4 * 3
  }, {
    x: battleArea.clientWidth,
    y: battleArea.clientHeight / 3
  }];
  patterns.forEach(pos => {
    const attack = document.createElement('div');
    attack.className = 'youtube-attack';
    attack.innerHTML = '<img src="1000001085-removebg-preview.png" alt="YouTube Logo">';
    attack.style.transform = `translate(${pos.x}px, ${pos.y}px)`;
    battleArea.appendChild(attack);
    youtubeAttacks.push({
      element: attack,
      x: pos.x,
      y: pos.y,
      vx: pos.x < 0 ? YOUTUBE_SPEED : -YOUTUBE_SPEED,
      vy: 0,
      startTime: Date.now()
    });
  });
}
function updateYoutubeAttacks() {
  youtubeAttacks.forEach((attack, index) => {
    attack.x += attack.vx;
    attack.y += attack.vy;
    attack.element.style.transform = `translate(${attack.x}px, ${attack.y}px)`;
    if (Date.now() - attack.startTime > 3000 || attack.x < -50 || attack.x > window.innerWidth + 50) {
      attack.element.remove();
      youtubeAttacks.splice(index, 1);
    }
  });
}</script>
</body></html>
